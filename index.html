<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AgroVision ‚Äî Farm Dashboard (Enhanced)</title>

<!-- Fonts & Icons -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet"/>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

<!-- Global styles -->
<link rel="stylesheet" href="assets/style.css" />
</head>
<body>
<div class="layout" id="layoutRoot">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar" aria-label="Main menu">
    <div class="sidebar-top">
      <div class="brand" title="AgroLink"><i class="ri-plant-line"></i><span class="brand-text">AgroLink</span></div>
      <nav class="nav" role="navigation">
        <h4>MENU</h4>
        <a href="#" class="active" title="Dashboard"><i class="ri-dashboard-line" aria-hidden="true"></i><span class="nav-label">Dashboard</span></a>
        <a href="crops.html" title="Crops"><i class="ri-seedling-line"></i><span class="nav-label">Crops</span></a>
        <a href="livestock.html" title="Livestock"><i class="ri-medicine-bottle-line"></i><span class="nav-label">Livestock</span></a>
        <a href="fields.html" title="Fields"><i class="ri-map-pin-line"></i><span class="nav-label">Fields</span></a>
        <a href="weather.html" title="Weather"><i class="ri-cloud-windy-line"></i><span class="nav-label">Weather</span></a>
        <a href="equipment.html" title="Equipment"><i class="ri-tools-line"></i><span class="nav-label">Equipment</span></a>
        <a href="finance.html" title="Finance"><i class="ri-money-dollar-box-line"></i><span class="nav-label">Finance</span></a>
        <a href="reports.html" title="Reports"><i class="ri-bar-chart-2-line"></i><span class="nav-label">Reports</span></a>
        <a href="settings.html" title="Settings"><i class="ri-settings-3-line"></i><span class="nav-label">Settings</span></a>
      </nav>
    </div>

    <!-- Sidebar footer weather -->
    <div class="sidebar-footer" aria-hidden="false">
      <div class="small-muted" style="margin-bottom:6px; font-weight:600">Local Weather</div>
      <div class="wrow">
        <div id="sidebarWeatherMain" style="display:flex; flex-direction:column; gap:4px;">
          <div id="sidebarWeatherSummary" class="small-muted">Loading...</div>
          <div id="sidebarWeatherTemp" style="font-weight:600"></div>
        </div>
        <div id="sidebarWeatherIcon" style="font-size:18px; opacity:.95"></div>
      </div>
      <div style="margin-top:8px; font-size:12px; color:rgba(255,255,255,0.6)">Updated: <span id="sidebarWeatherUpdated">‚Äî</span></div>
    </div>
  </aside>

  <!-- Mobile backdrop for sidebar -->
  <div id="sidebarBackdrop" class="sidebar-backdrop hidden" aria-hidden="true"></div>

  <!-- Main -->
  <main>
    <!-- Topbar -->
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:10px">
        <!-- Collapse / menu button (placed before search) -->
        <button id="collapseBtn" class="btn" aria-label="Toggle menu" title="Toggle menu"><i class="ri-menu-line"></i></button>

        <!-- Search -->
        <div class="search" role="search">
          <i class="ri-search-line" aria-hidden="true"></i>
          <input aria-label="Search" placeholder="Search fields, crops, tasks..." />
        </div>
      </div>

      <div class="top-actions">
        <button class="btn"><i class="ri-calendar-line"></i><span id="rangeLabel">01 Jan, 2025 to 31 Jan, 2025</span></button>
        <button id="exportCsvBtn" class="btn" title="Export KPI CSV"><i class="ri-file-download-line"></i></button>
        <button class="btn"><i class="ri-add-circle-line"></i> Add Record</button>

        <!-- Theme toggle keeps icon and a small label; JS updates only the label span -->
        <button id="themeToggle" class="theme-toggle btn" title="Toggle theme">
          <i class="ri-contrast-2-line" aria-hidden="true"></i>
          <span class="nav-label">Theme</span>
        </button>

        <div class="avatar" title="Profile">
          <img src="https://i.pravatar.cc/60?img=13" alt="">
          <div>
            <div style="font-weight:600">Oluwasegun Oyebode</div>
            <small class="subtitle">Farm Director</small>
          </div>
        </div>
      </div>
    </div>

    <div class="content">
      <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:14px;flex-wrap:wrap">
        <div>
          <div class="page-title">Good Morning, Oluwasegun!</div>
          <div class="subtitle">Here‚Äôs what‚Äôs happening across your farms today.</div>
        </div>
      </div>

      <!-- Metrics -->
      <section class="grid metrics" style="margin-top:16px">
        <div class="card">
          <div class="metric">
            <div>
              <small>Total Revenue</small>
              <h3 id="mRevenue">$559.25k</h3>
              <small class="up">‚ñ≤ +16.24%</small>
            </div>
            <div class="icon"><i class="ri-money-dollar-circle-line"></i></div>
          </div>
          <a class="subtitle" href="#" style="text-decoration:none">View breakdown</a>
        </div>

        <div class="card">
          <div class="metric">
            <div>
              <small>Total Harvest</small>
              <h3 id="mHarvest">36,894 t</h3>
              <small class="down">‚ñº ‚àí3.57%</small>
            </div>
            <div class="icon" style="background:#ecfeff;color:#0891b2"><i class="ri-scales-2-line"></i></div>
          </div>
          <a class="subtitle" href="#" style="text-decoration:none">See crop details</a>
        </div>

        <div class="card">
          <div class="metric">
            <div>
              <small>Active Fields</small>
              <h3 id="mFields">183</h3>
              <small class="up">‚ñ≤ +29.08%</small>
            </div>
            <div class="icon" style="background:#ecfdf5;color:#16a34a"><i class="ri-leaf-line"></i></div>
          </div>
          <a class="subtitle" href="#" style="text-decoration:none">Field status</a>
        </div>

        <div class="card">
          <div class="metric">
            <div>
              <small>Farm Balance</small>
              <h3 id="mBalance">$165.89k</h3>
              <small class="">‚Ä¢ +0.00%</small>
            </div>
            <div class="icon" style="background:#fff7ed;color:#f97316"><i class="ri-bank-card-line"></i></div>
          </div>
          <a class="subtitle" href="#" style="text-decoration:none">Withdraw / Transfer</a>
        </div>
      </section>

      <!-- Revenue + Map -->
      <section class="split" style="margin-top:16px">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <h4>Production & Revenue</h4>
            <div class="filters" id="filters">
              <button data-range="ALL" class="pill active" aria-pressed="true">ALL</button>
              <button data-range="1M" class="pill">1M</button>
              <button data-range="6M" class="pill">6M</button>
              <button data-range="1Y" class="pill">1Y</button>
            </div>
          </div>
          <!-- removed problematic inline width/height so chart is responsive and controlled by CSS -->
          <canvas id="revenueChart" aria-label="Production and revenue chart"></canvas>
          <div class="kpis">
            <div><b id="kpiShipments">7,585</b><span>Shipments</span></div>
            <div><b id="kpiRevenue">$22.89k</b><span>Revenue</span></div>
            <div><b id="kpiWastage">367</b><span>Wastage (t)</span></div>
            <div><b id="kpiYield">18.92%</b><span>Yield Efficiency</span></div>
          </div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <h4>Production by Locations</h4>
            <button class="btn">Export Report</button>
          </div>
          <div id="map" class="map-wrap" aria-label="Farm locations map"></div>
        </div>
      </section>

      <!-- AI Insights + Tasks -->
      <section style="margin-top:16px; display:grid; grid-template-columns:2fr 1fr; gap:16px">
        <div class="card">
          <h4>AI Insights</h4>
          <ul style="margin-top:8px; color:var(--muted); line-height:1.6">
            <li>üå± <strong>Kaduna:</strong> Irrigation efficiency down 5% ‚Äî schedule watering within 24h.</li>
            <li>üåæ <strong>Oyo:</strong> Soil nutrient levels optimal ‚Äî predicted yield +12% this season.</li>
            <li>‚òÄÔ∏è <strong>Nairobi Dairy:</strong> Temperature spikes expected ‚Äî increase shade/cooling.</li>
          </ul>
        </div>

        <div class="card">
          <h4>Operations Tasks</h4>
          <ul id="opTasks" style="margin-top:8px; color:var(--muted); line-height:1.6">
            <li>üîß Repair harvester belt ‚Äî <small>Due: Fri</small></li>
            <li>üíß Irrigate Field 3 (Maize) ‚Äî <small>Due: Today 16:00</small></li>
            <li>üß™ Soil sample Field 7 ‚Äî <small>Due: Mon</small></li>
          </ul>
          <div style="margin-top:10px; display:flex; gap:8px">
            <button id="addOpTask" class="btn">Add Task</button>
            <button id="downloadTasks" class="btn">Export Tasks</button>
          </div>
        </div>
      </section>
    </div>
  </main>
</div>

<!-- Floating actions -->
<div class="footer-actions" aria-hidden>
  <button class="fab" title="Settings"><i class="ri-equalizer-line"></i></button>
  <button class="fab" title="Help" style="background:#22c55e"><i class="ri-question-line"></i></button>
</div>

<!-- Script (global) -->
<script src="assets/script.js"></script>
</body>
</html>
